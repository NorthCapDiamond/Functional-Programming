# Лабораторная работа 1. Проект Эйлера

Вариант: 12, 19

Автор: Дробыш Дмитрий Александрович P34082 333219

Цель: освоить базовые приёмы и абстракции функционального программирования: функции, поток управления и поток данных, рекурсия, свёртка, отображение, списки.

## Условие

### Задача 12:

The sequence of triangle numbers is generated by adding the natural numbers. So the 7-th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be: 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...

Let us list the factors of the first seven triangle numbers:

1: 1

3: 1, 3

6: 1, 2, 3, 6

10: 1, 2, 5, 10

15: 1, 3, 5, 15

21: 1, 3, 7, 21

28: 1, 2, 4, 7, 14, 28

We can see that

is the first triangle number to have over five divisors.

What is the value of the first triangle number to have over five hundred divisors?


### Задача 12:

You are given the following information, but you may prefer to do some research for yourself.

    1 Jan 1900 was a Monday.
    Thirty days has September,
    April, June and November.
    All the rest have thirty-one,
    Saving February alone,
    Which has twenty-eight, rain or shine.
    And on leap years, twenty-nine.
    A leap year occurs on any year evenly divisible by 4, but not on a century unless it is divisible by 400.

How many Sundays fell on the first of the month during the twentieth century (1 Jan 1901 to 31 Dec 2000)?

## Реализация

Полный код различных реализаций представлен в `src`. Ниже продемонстрированы куски, явно использующие необходимые подходы

### Различные реализации задания 12

Служебная функция `divider` Проверяет делимость a на b и возвращает либо #t, либо #f:

```guile
(define (divider? a b)
  (zero? (modulo a b)))
```

- Рекурсия:

```guile
(define (inner current i answer n)
  (if (>= i (sqrt current))
    (if (integer? (sqrt current))
      (if (>= (+ answer 1) n)
	current #f)
      (if (>= answer n)
	current #f))
    (if (and (divider? current i) (<= i (sqrt current)))
    	(inner current (+ i 1) (+ answer 2) n )
    	(inner current (+ i 1) answer n ))))

(define (solution counter current answer n)
  (if(inner current 1 answer n)
    (inner current 1 answer n)
    (solution (+ counter 1) (+ counter current 1) answer n)))
```

- Реализация с использованием бесконечных списков:

```guile
(define (triangle-numbers n i)
  (cons (/ (* (+ n 1) i) 2)
	(delay(triangle-numbers (+ n 1) (+ i 1)))))

(define (natural-numbers n)
  (cons n (delay(natural-numbers (+ n 1)))))

(define (n-th-triangle-number tn n)
  (if (= n 1)
    (car tn)
    (n-th-triangle-number (force (cdr tn)) (- n 1))))

(define (range-1-to-n n)
  (if (= n 0)
      '() 
      (append (range-1-to-n (- n 1)) (list n))))

(define (divisors-counter number list-divs)
  (define (divider? n d) (zero? (modulo n d)))
  (length (filter (lambda (d) (divider? number d)) list-divs)))



(define (solver list-a divs)
  (if ( >= (divisors-counter (car list-a) (range-1-to-n (car list-a))) divs)
    (car list-a)
    (solver (force (cdr list-a)) divs)))
(define triangles (triangle-numbers 1 1))
```

- Реализация на языке `C` + `Guile' (language feature):

```C
/* Solution of Task 12 Starting Guile from C */

#include <libguile.h>
#include <stdio.h>
#include <stdint.h>

int main(int argc, char** argv){

  SCM tailrec;
  scm_init_guile();

  scm_c_primitive_load("12_withc.scm");
  tailrec = scm_variable_ref(scm_c_lookup("inner"));


  //printf("Enter your n\n");
  uint64_t n = 30;
  //scanf("%lu", &n);
  uint64_t res = 0;
  uint64_t answer = 0;
  uint64_t counter = 0;
  uint64_t current = 0;
  
  for(;;){
	  counter+=1;
	  current+=counter;
	  answer = 0;

	  res = scm_to_int(scm_call_4(tailrec, scm_from_int(current), scm_from_int(1), scm_from_int(answer), scm_from_int(n)));

	  if(res >= n){
		  printf("Answer is %ld\n", current);
		  break;
	  }

  }


  return 0;
}
```

```guile
(define (inner current i answer n)
  (if (>= i (sqrt current))
      (if (integer? (sqrt current))
          (if (>= (+ answer 2) n)
              current
              0)
          (if (>= answer n)
              current
              0))
      (if (and (divider? current i) (<= i (sqrt current)))
          (inner current (+ i 1) (+ answer 2) n)
          (inner current (+ i 1) answer n))))
```
- Реализация на языке `Python`


```python

"""Module solves task 12 of project Euler""" 
from math import sqrt, floor, ceil

def solution(n):
    """Return minimal triangular number with n dividers"""
    counter = 0
    current = 0

    while True:
        counter+=1
        current+=counter

        ans = 0
        for i in range(1, int(sqrt(current))+1):
            if current%i == 0:
                ans+=2

        if floor(sqrt(current)) == ceil(sqrt(current)):
            ans+=1

        if ans>=n:
            return current
```

### Различные реализации задания 19

Служебная функция `divider` Проверяет делимость a на b и возвращает либо #t, либо #f:
Служебная функция `days` Находит количество дней в указанном месяце указанного года:


```guile
(define (divider? a b)
  (zero? (modulo a b)))

(define (days year month)
  (if (or (= month 4) (= month 6) (= month 9) (= month 11))
    30
    (if (= month 2)
      (if (and (divider? year 4) (or (not (divider? year 100)) (divider? year 400)))
	29 28) 31)))
```

- Хвостовая рекурсия:

```guile
(define (solution year_id month_id day_id year_limit month_limit day_limit sunny)
  (if (and (<= year_id 2000) (not(and (= year_id year_limit) (>= month_id month_limit) (>= day_id day_limit))))
    (if (> day_id (days year_id month_id))
	 (solution year_id (+ month_id 1) (- day_id (days year_id month_id)) year_limit month_limit day_limit sunny)
	 (if( > month_id 12)
	   (solution (+ year_id 1) 1 day_id year_limit month_limit day_limit sunny)
	   (if (and(= day_id 1) (> year_id 1900))
	     (solution year_id month_id (+ day_id 7) year_limit month_limit day_limit (+ sunny 1))
	     (solution year_id month_id (+ day_id 7) year_limit month_limit day_limit sunny)))) sunny))
(display (string-append "Answer is " (number->string(solution 1900 1 0 2000 12 31 0)) "\n"))
```

- явное разделение на генерацию, фильтрацию и свертку

```guile
(define (gen-calendar year_id month_id day_id year_limit month_limit day_limit dayname)
  (if (and (<= year_id year_limit) (not (and (>= year_id year_limit) (>= month_id month_limit) (>= day_id day_limit))))
    (begin(if (> day_id (days year_id month_id))
          (gen-calendar year_id (+ month_id 1) 1 year_limit month_limit day_limit dayname)
          (begin (if (> month_id 12)
                (gen-calendar (+ year_id 1) 1 day_id year_limit month_limit day_limit dayname)
                (begin (if (>= dayname 8)
			 (gen-calendar year_id month_id day_id year_limit month_limit day_limit 1)
			 (cons (list day_id dayname) (gen-calendar year_id month_id (+ day_id 1) year_limit month_limit day_limit (+ 1 dayname)))))))))'()))



(define (replace-pairs calendar-list)
  (map (lambda (pair) (if (equal? pair '(1 1)) 1 0))
       calendar-list))

(define (ones-counter list-ones-zeros)
  (fold-right + 0 list-ones-zeros))

```

- Реализация на языке `Python`:

```python

"""Module solves task 19 of project Euler"""

def days(year, month):
    """Return amount of days in 'year : month'"""
    if month in [4, 6, 9, 11]:
        return 30
    if month == 2:
        if year % 4 == 0 and year % 100 != 0 or year % 400 == 0:
            return 29
        return 28
    return 31



def solution(year_id, month_id, day_id):
    """Return amount of sundays"""
    sun_first = 0
    while (year_id <= 2000 and month_id <= 12 and day_id <= 31):
        if(day_id == 1 and year_id > 1900):
            sun_first+=1
        day_id+=7
        days_month = days(year_id, month_id)

        if day_id > days_month:
            day_id -= days_month
            month_id+=1

            if month_id > 12:
                month_id = 1
                year_id+=1

    return sun_first

```


- Реализация на языке `C` + `Guile' (language feature):

```C
#include <stdio.h>
#include <stdint.h>
#include <libguile.h>

int main(){
	printf("Enter: year_start month_start day_start yer_limit month_limit day_limit\n");
	uint64_t year_start = 1901;
	uint64_t month_start = 1;
	uint64_t day_start = 1;

	uint64_t year_limit = 2000;
	uint64_t month_limit = 12;
	uint64_t day_limit = 31;

	uint64_t res;

	//scanf("%lu", &year_start);
	//scanf("%lu", &month_start);
	//scanf("%lu", &day_start);

	//scanf("%lu", &year_limit);
	//scanf("%lu", &month_limit);
	//scanf("%lu", &day_limit);

	uint64_t sunny = 0;

	SCM solution_f;	
	scm_init_guile();
	scm_c_primitive_load("19_withc.scm");
	solution_f = scm_variable_ref(scm_c_lookup("solution"));

	res = scm_to_int(scm_call_7(solution_f, scm_from_int(year_start), scm_from_int(month_start), scm_from_int(day_start), scm_from_int(year_limit), scm_from_int(month_limit), scm_from_int(day_limit), scm_from_int(sunny)));

	printf("Answer is %ld\n", res);
	return 0;

}
```

```guile

(define (solution year_id month_id day_id year_limit month_limit day_limit sunny)
  (if (and (<= year_id 2000) (not(and (= year_id year_limit) (>= month_id month_limit) (>= day_id day_limit))))
    (if (> day_id (days year_id month_id))
	 (solution year_id (+ month_id 1) (- day_id (days year_id month_id)) year_limit month_limit day_limit sunny)
	 (if( > month_id 12)
	   (solution (+ year_id 1) 1 day_id year_limit month_limit day_limit sunny)
	   (if (and(= day_id 1) (> year_id 1900))
	     (solution year_id month_id (+ day_id 7) year_limit month_limit day_limit (+ sunny 1))
	     (solution year_id month_id (+ day_id 7) year_limit month_limit day_limit sunny)))) sunny))
```


### Вывод
Лабораторная работа получилось достаточно сложной, если учитывать полное отсутствие опыта работы с функциональными языками. 
Сначала писал решение задачи через хвостовую рекурсию... 
потом модифицировать на обычную показалось несколько странным. 
Когда начал изучать map, fold, delay.., начал несколько иначе думать над решением задачи.


На мой взгляд:

Самый читаемый - отображение, фильтрация

Самый простой в написании - любой на python.

Самый интересный в написании - хвостовая рекурсия
